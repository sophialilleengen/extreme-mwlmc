## Notes for running on Tursa

There are some idiosyncracies to running on Tursa. In particular, the job submission script requires very specific settings in order to maximise network connectivity.
See here: https://epcced.github.io/dirac-docs/tursa-user-guide/scheduler/#example-job-submission-script-for-grid-parallel-job-using-cuda

This directory has working recipes for Tursa.

| Run name | Ndisc | Nhalo |
|----------|----------|---------|
| 00 | 10M | 50M |
| 000 | 100M | 100M |
| 0000 | 46M | 800M |
| 00000 | 155M | 1670M |

### Benchmarks

A run with 800M halo, 46M disc, on 32 GPUs has the following parameters:
```
|===============================+======================+======================|
|   0  NVIDIA A100-SXM...  On   | 00000000:03:00.0 Off |                    0 |
| N/A   30C    P0   112W / 500W |  16098MiB / 81251MiB |      7%      Default |
|                               |                      |             Disabled |
+-------------------------------+----------------------+----------------------+
```

Reported timings for `multistep:3`:
```
----------------------------------------------------------------------
--- Timer info [T=0.0016] --------------------------------------------
----------------------------------------------------------------------
Drift               : 0.0613014          [  0.11 %]
Velocity            : 0.129659           [  0.23 %]
Force               : 40.3298            [ 70.89 %]
Coefs               : 3.23056            [  5.68 %]
Output              : 4.54536            [  7.99 %]
Levels              : 0.0380594          [  0.07 %]
Report              : 2.863e-06          [  0.00 %]
Balance             : 2.305e-06          [  0.00 %]
Adjust              : 8.55805            [ 15.04 %]
Cuda copy           : 0.943493           [  1.66 %]
Orient              : 1.99886            [  3.51 %]
Total               : 56.8929            [100.00 %]
----------------------------------------------------------------------
```

And levels:
```
------------------------------------------------------------
--- Component <mwhalo, sphereSL>, T=0.0016------------------
------------------------------------------------------------
L  Number    dN/dL     N(<=L)    
------------------------------------------------------------
0  644775867 0.806     0.806     
1  89799624  0.112     0.918     
2  48184634  0.060     0.978     
3  17239875  0.022     1.000     

------------------------------------------------------------
--- Component <mwdisc, cylinder>, T=0.0016------------------
------------------------------------------------------------
L  Number    dN/dL     N(<=L)    
------------------------------------------------------------
0  24928868  0.542     0.542     
1  13685080  0.298     0.839     
2  6665210   0.145     0.984     
3  720842    0.016     1.000   
```


A run with 100M halo, 100M disc, on 16 GPUs has the following parameters:
```
|===============================+======================+======================|
|   0  NVIDIA A100-SXM...  On   | 00000000:03:00.0 Off |                    0 |
| N/A   29C    P0    66W / 500W |   5276MiB / 81251MiB |      0%      Default |
|                               |                      |             Disabled |
+-------------------------------+----------------------+----------------------+
```

Reported timings for `multistep:4`
```
----------------------------------------------------------------------
--- Timer info [T=0.002] ---------------------------------------------
----------------------------------------------------------------------
Drift               : 0.121763           [  0.20 %]
Velocity            : 0.251601           [  0.41 %]
Force               : 48.7177            [ 79.87 %]
Coefs               : 1.84684            [  3.03 %]
Output              : 1.9813             [  3.25 %]
Levels              : 0.0329397          [  0.05 %]
Report              : 2.375e-06          [  0.00 %]
Balance             : 1.886e-06          [  0.00 %]
Adjust              : 8.04561            [ 13.19 %]
Cuda copy           : 0.459138           [  0.75 %]
Orient              : 2.01488            [  3.30 %]
Total               : 60.9981            [100.00 %]
----------------------------------------------------------------------
```

`multistep` probably can be reduced to 3, as we currently see
```
------------------------------------------------------------
--- Component <mwhalo, sphereSL>, T=0.002-------------------
------------------------------------------------------------
L  Number    dN/dL     N(<=L)    
------------------------------------------------------------
0  75725017  0.757     0.757     
1  13114757  0.131     0.888     
2  7577842   0.076     0.964     
3  3089235   0.031     0.995     
4  493149    0.005     1.000     
```

